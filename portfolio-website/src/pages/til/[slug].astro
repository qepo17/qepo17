---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
  const tils = await getCollection('til');
  return tils.map((til) => ({
    params: { slug: til.slug },
    props: til,
  }));
}

const til = Astro.props;
const { Content } = await til.render();

function formatDate(date: Date) {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

const categoryColors: Record<string, string> = {
  ai: 'bg-purple-100 text-purple-700',
  coding: 'bg-blue-100 text-blue-700',
  research: 'bg-green-100 text-green-700',
  life: 'bg-yellow-100 text-yellow-700',
  tools: 'bg-orange-100 text-orange-700',
};

const categoryEmoji: Record<string, string> = {
  ai: 'ü§ñ',
  coding: 'üíª',
  research: 'üî¨',
  life: 'üå±',
  tools: 'üõ†Ô∏è',
};

const aiSources = ['neuro', 'kodi', 'claudia'];

function isAiSource(source: string | undefined): boolean {
  return source ? aiSources.includes(source.toLowerCase()) : false;
}
---

<BaseLayout title={til.data.title} description={`TIL: ${til.data.title}`}>
  <Header />
  
  <div class="min-h-screen bg-white">
    <article class="py-20">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl mx-auto">
          <!-- Meta info -->
          <div class="mb-8">
            <div class="flex flex-wrap items-center gap-3 mb-4">
              {til.data.category && (
                <span class={`inline-flex items-center gap-1 px-3 py-1 text-sm font-medium rounded-full ${categoryColors[til.data.category] || 'bg-neutral-100 text-neutral-700'}`}>
                  {categoryEmoji[til.data.category]} {til.data.category}
                </span>
              )}
              <time class="text-neutral-500" datetime={til.data.date.toISOString()}>
                {formatDate(til.data.date)}
              </time>
              {til.data.source && (
                isAiSource(til.data.source) ? (
                  <span class="inline-flex items-center gap-1 px-2 py-0.5 bg-neutral-100 rounded text-neutral-500 text-sm">
                    <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A2.5 2.5 0 0 0 5 15.5A2.5 2.5 0 0 0 7.5 18a2.5 2.5 0 0 0 2.5-2.5A2.5 2.5 0 0 0 7.5 13m9 0a2.5 2.5 0 0 0-2.5 2.5a2.5 2.5 0 0 0 2.5 2.5a2.5 2.5 0 0 0 2.5-2.5a2.5 2.5 0 0 0-2.5-2.5z"/>
                    </svg>
                    {til.data.source}
                  </span>
                ) : (
                  <span class="text-neutral-400">
                    ¬∑ by <span class="font-medium">{til.data.source}</span>
                  </span>
                )
              )}
            </div>
            
            <h1 class="text-3xl md:text-4xl font-bold text-foreground leading-tight">
              {til.data.title}
            </h1>
          </div>
          
          <!-- Content -->
          <div class="prose prose-lg prose-neutral max-w-none
                      prose-headings:text-foreground prose-headings:font-bold
                      prose-p:text-neutral-700 prose-p:leading-relaxed
                      prose-a:text-primary-600 prose-a:no-underline hover:prose-a:text-primary-700
                      prose-strong:text-foreground prose-strong:font-semibold
                      prose-code:text-primary-600 prose-code:bg-neutral-100 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:font-mono prose-code:text-sm
                      prose-pre:bg-neutral-900 prose-pre:text-neutral-100
                      prose-ul:text-neutral-700 prose-ol:text-neutral-700
                      prose-li:text-neutral-700">
            <Content />
          </div>
          
          <!-- Back link -->
          <div class="mt-12 pt-8 border-t border-neutral-200">
            <a 
              href="/til"
              class="inline-flex items-center text-primary-600 hover:text-primary-700 font-medium transition-colors"
            >
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
              Back to TIL
            </a>
          </div>
        </div>
      </div>
    </article>
  </div>
  
  <Footer />
</BaseLayout>
